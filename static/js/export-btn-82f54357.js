import{i as y}from"./index-f2a88b9d.js";import{F as w}from"./file-saver-e555b4c4.js";import{u as d,w as x,S as b}from"./xlsx-7367b54f.js";import{a as S}from"./element-plus-e43e0101.js";import{d as _,b as v,N as E,W as A}from"./@vue.runtime-core-3a9e54b6.js";import{r as F,i as D}from"./@vue.reactivity-747ae439.js";import"./@vue.runtime-dom-7b7b8a44.js";import"./@vue.shared-9aa0355e.js";import"./monaco-editor-9c9b0ff9.js";import"./store-2b1fd532.js";import"./dayjs-7a1ede46.js";import"./axios-aba6f0e0.js";import"./nprogress-f3b783e1.js";import"./lodash-es-d2af5045.js";import"./@vueuse.core-2f0af90d.js";import"./@vueuse.shared-8ce56883.js";import"./mitt-b509fb6d.js";import"./vue-router-19ed6b98.js";import"./pinia-9e37763f.js";import"./vue-demi-71ba0ef2.js";import"./vue-echarts-f1c2bb29.js";import"./resize-detector-a5205554.js";import"./echarts-be9a7bef.js";import"./tslib-54e39b60.js";import"./zrender-3d337fab.js";import"./mockjs-96a45e78.js";import"./vue-70666ebd.js";import"./@element-plus.icons-vue-e3809a99.js";import"./@popperjs.core-c75af06c.js";import"./@ctrl.tinycolor-f8748455.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-1d60d822.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui.dom-7994f002.js";import"./@floating-ui.core-614032f8.js";function $(e,p){p&&(e+=1462);var o=Date.parse(e);return(o-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3)}function N(e,p){for(var o={},r={s:{c:1e7,r:1e7},e:{c:0,r:0}},s=0;s!=e.length;++s)for(var h=0;h!=e[s].length;++h){r.s.r>s&&(r.s.r=s),r.s.c>h&&(r.s.c=h),r.e.r<s&&(r.e.r=s),r.e.c<h&&(r.e.c=h);var a={v:e[s][h]};if(a.v!=null){var f=d.encode_cell({c:h,r:s});typeof a.v=="number"?a.t="n":typeof a.v=="boolean"?a.t="b":a.v instanceof Date?(a.t="n",a.z=b._table[14],a.v=$(a.v)):a.t="s",o[f]=a}}return r.s.c<1e7&&(o["!ref"]=d.encode_range(r)),o}function g(){if(!(this instanceof g))return new g;this.SheetNames=[],this.Sheets={}}function k(e){for(var p=new ArrayBuffer(e.length),o=new Uint8Array(p),r=0;r!=e.length;++r)o[r]=e.charCodeAt(r)&255;return p}function B({multiHeader:e=[],header:p,data:o,filename:r,merges:s=[],autoWidth:h=!0,bookType:a="xlsx"}={}){r=r||"excel-list",o=[...o],o.unshift(p);for(let n=e.length-1;n>-1;n--)o.unshift(e[n]);var f="SheetJS",c=new g,i=N(o);if(s.length>0&&(i["!merges"]||(i["!merges"]=[]),s.forEach(n=>{i["!merges"].push(d.decode_range(n))})),h){const n=o.map(m=>m.map(l=>l==null?{wch:10}:l.toString().charCodeAt(0)>255?{wch:l.toString().length*2}:{wch:l.toString().length}));let t=n[0];for(let m=1;m<n.length;m++)for(let l=0;l<n[m].length;l++)t[l].wch<n[m][l].wch&&(t[l].wch=n[m][l].wch);i["!cols"]=t}c.SheetNames.push(f),c.Sheets[f]=i;var u=x(c,{bookType:a,bookSST:!1,type:"binary"});w.saveAs(new Blob([k(u)],{type:"application/octet-stream"}),`${r}.${a}`)}function W(){const e=new Date;return{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minu:e.getMinutes(),sec:e.getSeconds()}}const de=_({name:"cl-export-btn",props:{filename:[Function,String],autoWidth:{type:Boolean,default:!0},bookType:{type:String,default:"xlsx"},header:Array,columns:{type:Array,required:!0},data:[Function,Array],maxExportLimit:Number},setup(e){const p=F(!1),o=y.useCrud();async function r(f,c){return f.filter(i=>!i.hidden&&c.includes(i.prop)).map(i=>i.label)}function s(){var f,c;return typeof e.data=="function"?e.data():e.data?e.data:(c=o.value)==null?void 0:c.service.page({...(f=o.value)==null?void 0:f.paramsReplace(o.value.params),maxExportLimit:e.maxExportLimit,isExport:!0}).then(i=>i.list.map(u=>{for(const n in u){const t=e.columns.find(m=>m.prop==n);if(t&&(t.formatter&&(u=t.formatter(u)),t.dict)){const m=(D(t.dict)?t.dict.value:t.dict).find(l=>l.value==u[n]);m&&(u[n]=m.label)}}return u})).catch(i=>(S.error(i.message),null))}async function h(){if(typeof e.filename=="function")return await(e==null?void 0:e.filename());{const{year:f,month:c,day:i,hour:u,minu:n,sec:t}=W();return e.filename||`报表（${f}-${c}-${i} ${u}_${n}_${t}）`}}async function a(){if(!e.columns)return console.error("columns is required");p.value=!0;const f=e.columns.filter(t=>!(t.hidden===!0||["selection","expand","index"].includes(t.type)||t.filterExport||t["filter-export"])),c=f.map(t=>t.prop).filter(Boolean),i=await r(f,c);let u=await s();if(!u)return p.value=!1,console.error("导出数据异常");const n=await h();u=u.map(t=>c.map(m=>t[m])),B({header:i,data:u,filename:n,autoWidth:e.autoWidth,bookType:e.bookType}),p.value=!1}return()=>v(A("el-button"),{loading:p.value,onClick:a},{default:()=>[v("slot",null,[E("导出")])]})}});export{de as default};
