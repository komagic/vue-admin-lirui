import{w as M}from"./@vue.runtime-dom-7b7b8a44.js";import{i as N,f as j}from"./index-c663178e.js";import"./store-2b1fd532.js";import{u as U}from"./index-a427384e.js";import{B as A,W as J,X as K,Y as L,P}from"./@element-plus.icons-vue-e3809a99.js";import{d as V,W as l,o as p,I as C,J as r,b as t,n as R,ag as X,_ as G,c as v,a as c,F as Y,U as Q,K as x,am as Z,al as ee,N as O}from"./@vue.runtime-core-3a9e54b6.js";import{r as H,j as te,u as i}from"./@vue.reactivity-747ae439.js";import{a as w,b as q}from"./element-plus-e43e0101.js";import{o as oe,O as E}from"./@vue.shared-9aa0355e.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";import"./monaco-editor-b2c0bceb.js";import"./axios-aba6f0e0.js";import"./nprogress-f3b783e1.js";import"./dayjs-7a1ede46.js";import"./lodash-es-d2af5045.js";import"./@vueuse.core-2f0af90d.js";import"./@vueuse.shared-8ce56883.js";import"./mitt-b509fb6d.js";import"./vue-router-19ed6b98.js";import"./pinia-9e37763f.js";import"./vue-demi-71ba0ef2.js";import"./vue-echarts-f1c2bb29.js";import"./resize-detector-a5205554.js";import"./echarts-be9a7bef.js";import"./tslib-54e39b60.js";import"./zrender-3d337fab.js";import"./mockjs-96a45e78.js";import"./vue-70666ebd.js";import"./@popperjs.core-c75af06c.js";import"./@ctrl.tinycolor-f8748455.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-1d60d822.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui.dom-7994f002.js";import"./@floating-ui.core-614032f8.js";const ne=V({name:"undefined"}),ae=V({...ne,setup(k,{expose:a}){const{service:W}=U(),f=H(!1),$=H(""),h=te({status:[{label:"成功",value:1,type:"success"},{label:"失败",value:0,type:"danger"}]}),T=N.useTable({autoHeight:!1,columns:[{label:"#",type:"index"},{label:"描述",prop:"detail",showOverflowTooltip:!0,minWidth:200},{label:"执行状态",prop:"status",minWidth:120,dict:h.status},{label:"执行时间",prop:"createTime",minWidth:160}]}),d=N.useCrud({service:W.task.info,dict:{api:{page:"log"}}});function F(b){f.value=!0,$.value=`日志列表（${b.name}）`,R(()=>{var m;(m=d.value)==null||m.refresh({id:b.id,page:1})})}function I(){f.value=!1}return a({open:F,close:I}),(b,m)=>{const B=l("cl-refresh-btn"),e=l("cl-select"),s=l("cl-filter"),o=l("cl-row"),u=l("cl-table"),g=l("cl-flex1"),y=l("cl-pagination"),_=l("cl-crud"),n=l("cl-dialog");return p(),C(n,{modelValue:f.value,"onUpdate:modelValue":m[0]||(m[0]=S=>f.value=S),title:$.value,width:"1000px"},{default:r(()=>[t(_,{ref_key:"Crud",ref:d,padding:"0"},{default:r(()=>[t(o,null,{default:r(()=>[t(B),t(s,{label:"状态"},{default:r(()=>[t(e,{options:h.status,prop:"status"},null,8,["options"])]),_:1})]),_:1}),t(o,null,{default:r(()=>[t(u,{ref_key:"Table",ref:T},null,512)]),_:1}),t(o,null,{default:r(()=>[t(g),t(y)]),_:1})]),_:1},512)]),_:1},8,["modelValue","title"])}}}),z=k=>(Z("data-v-4c9b2936"),k=k(),ee(),k),le={class:"list"},re=["onClick"],ie={class:"name"},pe={class:"row"},ce=z(()=>c("span",null,"执行服务",-1)),ue={class:"row"},de=z(()=>c("span",null,"定时规则",-1)),me={class:"status"},_e=z(()=>c("p",null,"添加计划任务",-1)),fe=V({name:"task-list"}),ve=V({...fe,setup(k){const{service:a,refs:W,setRefs:f}=U(),{browser:$}=j(),h=N.useForm(),T=H([]);function d(){a.task.info.page({size:100,page:1}).then(e=>{T.value=e.list.map(s=>(s.every&&(s.every/=1e3),s))})}function F(e){q.confirm(`此操作将启用任务（${e.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{a.task.info.start({id:e.id,type:e.type}).then(()=>{d()}).catch(s=>{w.error(s.message)})}).catch(()=>null)}function I(e){q.confirm(`此操作将停用任务（${e.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{a.task.info.stop({id:e.id}).then(()=>{d()}).catch(s=>{w.error(s.message)})}).catch(()=>null)}function b(e){q.confirm(`此操作将删除任务（${e.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{a.task.info.delete({ids:[e.id]}).then(()=>{d()}).catch(s=>{w.error(s.message)})}).catch(()=>null)}function m(e){W.log.open(e)}async function B(e){var s;if(e&&!a.task.info._permission.update)return!1;(s=h.value)==null||s.open({title:"编辑计划任务",width:"600px",props:{labelWidth:"80px"},items:[{label:"名称",prop:"name",component:{name:"el-input",props:{placeholder:"请输入名称"}},required:!0},{label:"类型",prop:"taskType",value:0,component:{name:"el-radio-group",options:[{label:"cron",value:0},{label:"时间间隔",value:1}]},required:!0},{label:"cron",prop:"cron",hidden:({scope:o})=>o.taskType==1,component:{name:"el-input",props:{placeholder:"* * * * * *"}},required:!0},{label:"间隔(秒)",prop:"every",hidden:({scope:o})=>o.taskType==0,hook:{bind(o){return o/1e3},submit(o){return o*1e3}},component:{name:"el-input-number",props:{min:1,max:1e8}},required:!0},{label:"service",prop:"service",component:{name:"el-input",props:{placeholder:"taskDemoService.test([1, 2])"}}},{label:"开始时间",prop:"startDate",hidden:({scope:o})=>o.taskType==1,component:{name:"el-date-picker",props:{type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:3}}}],form:{...e},on:{submit:(o,{close:u,done:g})=>{o.limit||(o.limit=null),a.task.info[e!=null&&e.id?"update":"add"](o).then(()=>{d(),w.success("保存成功"),u()}).catch(y=>{w.error(y.message),g()})}}})}return X(()=>{d()}),(e,s)=>{const o=l("el-tag"),u=l("el-icon"),g=l("cl-flex1"),y=l("cl-form"),_=G("permission");return p(),v("div",{class:oe(["task-list",{"is-mini":i($).isMini}])},[c("div",le,[(p(!0),v(Y,null,Q(T.value,(n,S)=>(p(),v("div",{class:"item",key:S,onClick:D=>B(n)},[c("p",ie,E(n.name),1),c("p",pe,[ce,c("span",null,E(n.service),1)]),c("p",ue,[de,c("span",null,E(n.taskType==1?`间隔${n.every}秒执行`:n.cron),1)]),c("div",me,[n.status?(p(),v(Y,{key:0},[t(o,{"disable-transitions":"",effect:"dark",type:"success"},{default:r(()=>[O("进行中")]),_:1}),x((p(),C(u,{class:"pause",onClick:M(D=>I(n),["stop"])},{default:r(()=>[t(i(J))]),_:2},1032,["onClick"])),[[_,i(a).task.info.permission.stop]])],64)):(p(),v(Y,{key:1},[t(o,{"disable-transitions":"",effect:"dark",type:"danger"},{default:r(()=>[O("已停止")]),_:1}),x((p(),C(u,{class:"play",onClick:M(D=>F(n),["stop"])},{default:r(()=>[t(i(K))]),_:2},1032,["onClick"])),[[_,i(a).task.info.permission.start]])],64)),t(g),x((p(),C(u,{class:"log",onClick:M(D=>m(n),["stop"])},{default:r(()=>[t(i(L))]),_:2},1032,["onClick"])),[[_,i(a).task.info.permission.log]]),x((p(),C(u,{class:"delete",onClick:M(D=>b(n),["stop"])},{default:r(()=>[t(i(P))]),_:2},1032,["onClick"])),[[_,i(a).task.info.permission.delete]])])],8,re))),128)),x((p(),v("div",{class:"item is-add",onClick:s[0]||(s[0]=n=>B())},[t(u,null,{default:r(()=>[t(i(A))]),_:1}),_e])),[[_,i(a).task.info.permission.add]])]),t(y,{ref_key:"Form",ref:h},null,512),t(ae,{ref:i(f)("log")},null,512)],2)}}});const Ze=se(ve,[["__scopeId","data-v-4c9b2936"]]);export{Ze as default};
