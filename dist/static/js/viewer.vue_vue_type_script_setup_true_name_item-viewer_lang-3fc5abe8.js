import{p as h,o as F,u as I}from"./index-8b7486b1.js";import{z as M}from"./lodash-es-d2af5045.js";import{W as _}from"./ts-wps-d32de3c6.js";import"./store-2b1fd532.js";import{u as x}from"./index-7911eabc.js";import{a as S}from"./element-plus-e43e0101.js";import{d as c,W as g,o as m,I as y,J as T,a as k,c as W,M as B,b as P}from"./@vue.runtime-core-3a9e54b6.js";import{r as w,j as V,u as j,t as R}from"./@vue.reactivity-747ae439.js";const d=[{label:"图片",value:"image",format:["bmp","jpg","jpeg","png","tif","gif","svg","webp"],color:"#67C23A"},{label:"视频",value:"video",format:["avi","wmv","mpg","mpeg","mov","rm","ram","swf","flv","mp4"],color:"#409EFF"},{label:"音频",value:"audio",format:["mp3","wav","wma","mp2","flac","midi","ra","ape","aac","cda"],color:"#E6A23C"},{label:"文字",value:"Writer",format:["doc","dot","wps","wpt","docx","dotx","docm","dotm"],color:"#F56C6C"},{label:"表格",value:"Spreadsheet",format:["xls","xlt","et","xlsx","xltx","xlsm","xltm"],color:"#F56C6C"},{label:"演示",value:"Presentation",format:["ppt","pptx","pptm","ppsx","ppsm","pps","potx","potm","dpt","dps"],color:"#F56C6C"},{label:"PDF",value:"Pdf",format:["pdf"],color:"#F56C6C"},{label:"文件",value:"file",format:[],color:"#909399"}];function Q(e=0){return e<1024?e+"B":e<Math.pow(1024,2)?(e/1024).toFixed(2)+"K":e<Math.pow(1024,3)?(e/Math.pow(1024,2)).toFixed(2)+"M":e<Math.pow(1024,4)?(e/Math.pow(1024,3)).toFixed(2)+"G":(e/Math.pow(1024,4)).toFixed(2)+"T"}function X(e){return h(e.substring(e.indexOf("_")+1))}function Y(e){return d.find(l=>l.format.find(p=>p==F(e).toLocaleLowerCase()))||M(d)}function Z(e){return d.find(n=>n.value==e)}function z(e){return e.map(n=>n.url.replace(/,/g,encodeURIComponent(","))).join(",")}const D=k("div",{class:"wps-viewer"},null,-1),E=c({name:"undefined"}),N=c({...E,props:{officeType:{type:String,default:"Writer"},fileId:{type:String,default:""},token:String},setup(e,{expose:n}){const l=e,{service:p}=x(),{user:t}=I(),r=w(""),u=w(!1);async function o(){r.value||await p.space.info.getConfig().then(f=>{r.value=f.appId})}let i=null;async function s(f){if(u.value=!0,await o(),!r.value)return S.error("请先配置WPS的应用ID");i=_.init({officeType:_.OfficeType[f.officeType||l.officeType],appId:r.value,fileId:f.fileId||l.fileId,mount:document.querySelector(".wps-viewer"),fileToken:{token:t.token,timeout:10*60*1e3}}),i.ready()}function a(){i.destroy()}return n({open:s}),(f,v)=>{const b=g("cl-dialog");return m(),y(b,{modelValue:u.value,"onUpdate:modelValue":v[0]||(v[0]=C=>u.value=C),width:"80%",height:"70vh",onClosed:a},{default:T(()=>[D]),_:1},8,["modelValue"])}}});const O={class:"item-viewer"},A=c({name:"item-viewer"}),ee=c({...A,setup(e,{expose:n}){const{refs:l,setRefs:p}=x(),t=V({visible:!1,urls:[],index:0});function r(o,i){var s;if(o.type){if(o.type=="image")return t.visible=!0,t.urls=i.filter(a=>a.type=="image").map(a=>a.url||""),t.index=t.urls.findIndex(a=>a==o.url),!0;if(["Writer","Spreadsheet","Presentation","PDF"].includes(o.type))return(s=l.wps)==null?void 0:s.open(Object.assign(R(o),{officeType:o.type}))}window.open(o.url)}function u(){t.visible=!1}return n({open:r}),(o,i)=>{const s=g("el-image-viewer");return m(),W("div",O,[t.visible?(m(),y(s,{key:0,"url-list":t.urls,"initial-index":t.index,infinite:"",teleported:"",onClose:u},null,8,["url-list","initial-index"])):B("",!0),P(N,{ref:j(p)("wps")},null,512)])}}});export{ee as _,X as a,Q as b,Y as c,Z as f,z as g};
